// Generated by CoffeeScript 1.7.1
(function() {
  if (!String.prototype.trim) {
    String.prototype.trim = function() {
      return this.replace(/^\s+|\s+$/g, "");
    };
  }

  $(document).ready(function() {
    var current, recent_messages, refresh, reload, size, updateClass;
    current = [];
    recent_messages = [];
    size = 5;
    reload = function() {
      return $.get('/messages/recent', function(data) {
        recent_messages = data.messages;
        return setTimeout(reload, 20000);
      });
    };
    updateClass = function() {
      return $(".message-box .content").each(function() {
        var length;
        length = $(this).text().trim().length;
        if (length < 10) {
          return $(this).addClass('text-large');
        } else if (length > 10 && length < 40) {
          return $(this).addClass('text-medium');
        } else {
          return $(this).addClass('text-small');
        }
      });
    };
    refresh = function(start) {
      var total;
      total = recent_messages.length;
      console.log("start:" + start + " total: " + total);
      if (start < total) {
        current = recent_messages.slice(start, start + size);
        start += size;
      } else {
        current = recent_messages.slice(0, size);
        start = 0;
      }
      way.set("messages", current);
      return setTimeout(function() {
        $(".message-box").fadeOut('slow');
        refresh(start);
        $(".message-box").fadeIn('slow');
        return updateClass();
      }, 3000);
    };
    reload();
    return refresh(0);
  });

}).call(this);
