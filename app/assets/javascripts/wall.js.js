// Generated by CoffeeScript 1.7.1
(function() {
  var INTERVAL, SIZE, per_page, wall, wall_id;

  if (!String.prototype.trim) {
    String.prototype.trim = function() {
      return this.replace(/^\s+|\s+$/g, "");
    };
  }

  wall_id = null;

  wall = {};

  SIZE = 5;

  per_page = SIZE;

  INTERVAL = 3000;

  window.main = {
    initialize: function(id) {
      return this.load(id);
    },
    wall_url: function(id) {
      return "/walls/" + id + ".json";
    },
    load: function(id) {
      return $.get(this.wall_url(id), function(data) {
        wall = data.wall;
        way.set("wall", wall);
        wall_id = id;
        if (wall.background_image_url) {
          $("body").css("background-image", "url(" + wall.background_image_url + ")");
        }
        return main.draw(0);
      });
    },
    draw: function(start) {
      var current, next_start, normal, sticky;
      normal = wall.messages;
      sticky = wall.sticky_messages;
      current = wall.messages.slice(start, start + per_page);
      if (sticky.length > 0) {
        per_page = SIZE - sticky.length;
        current = sticky.concat(normal.slice(start, start + per_page));
      }
      next_start = start + (per_page - sticky.length);
      way.set("messages", current);
      this.updateClass();
      if (normal[next_start]) {
        return setTimeout(function() {
          return main.draw(start + per_page);
        }, INTERVAL);
      } else {
        return setTimeout(function() {
          return main.load(wall_id);
        }, INTERVAL);
      }
    },
    updateClass: function() {
      return $(".message-box .content").each(function() {
        var length;
        length = $(this).text().trim().length;
        if (length < 10) {
          return $(this).addClass('text-large');
        } else if (length > 10 && length < 40) {
          return $(this).addClass('text-medium');
        } else {
          return $(this).addClass('text-small');
        }
      });
    }
  };

  $(document).ready(function() {
    if (screenfull.isFullscreen) {
      $("#exit_full_screen").show();
    } else {
      $("#enter_full_screen").show();
    }
    if (screenfull.enabled) {
      $("#enter_full_screen").click(function() {
        screenfull.request();
        $("#enter_full_screen").hide();
        return $("#exit_full_screen").show();
      });
      return $("#exit_full_screen").click(function() {
        screenfull.exit();
        $("#exit_full_screen").hide();
        return $("#enter_full_screen").show();
      });
    }
  });

}).call(this);
